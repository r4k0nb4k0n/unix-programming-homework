# 11. 메모리 관리
## 메모리
* 프로세스에서 사용 가능한 자원 중에서 가장 기본적이면서 핵심이 되는 자원
* 할당, 조작, 해제 등의 메모리 자원 기법 설명
* 여기서 말하는 메모리는 컴퓨터 시스템에 장착되어 있는 RAM을 뜻함.
## 프로세스 주소 공간
* 각 프로세스는 독립적인 크기의 가상 주소 공간을 가짐
	* 32bit 컴퓨터의 경우 `2^32` 바이트 만큼의 주소 공간 가짐
* 페이지(Page)
	* 가상 주소 공간의 기본 구성 요소
	* 보통 `4KB` or `8KB`. (CPU에 따라 크기를 임의로 설정할 수 있음)
	* 유효 페이지와 유효하지 않은 페이지로 나뉨
		* 물리 메모리에 존재하거나 스왑 파티션에 존재하면 유효함
		* 유효하지 않은 메모리에 접근하면 세그멘테이션 폴트 발생
* 페이지 프레임(Page Frame)
	* 물리 메모리의 공간으로 페이지와 대응됨
* 페이지 테이블(Page Table)
	* 가상 주소 공간의 페이지가 실제 물리적으로 어디에 위치하는지를 나타냄
	* 운영체제 프로그래머는 페이지 테이블만 구축해 놓으면 컴퓨터 시스템이 MMU(Memory Management unit)이라는 하드웨어를 통해 물리 메모리로 접근  
![process-address-space](./process_address_space.png?raw=true)
## Share, Copy-On-Write
![share, copy-on-write](./share_copy_on_write.png?raw=true)
## 메모리 영역
![memory area](./memory_area.png?raw=true)
## 메모리 관련 함수들
* [동적 메모리 할당하기](./malloc)
* [배열 할당하기](./calloc)
* [할당 크기 조정](./realloc)
## 메모리 정렬
* 정렬된 상태
	* 메모리 블록(워드)의 배수가 되는 메모리 주소에 위치한 변수나 데이터를 지칭
	* 예
		- `32`비트 변수의 경우 `4`의 배수인 메모리 주소에 위치할 경우(최하위 비트가 `00`인 경우)
		- `2^n`바이트 타입일 경우 `n`개의 비트가 `0`
* 시스템의 성능을 위해서 메모리 정렬은 매우 중요
	* 리눅스에서 메모리 할당을 하면 `32`비트 시스템이면 `8`바이트 경계, `64`비트이면 `16`바이트 경계에 정렬된 메모리를 반환
* 좀 더 큰 메모리 경계 단위로 메모리를 요구해야 할 경우
	* 다른 메모리 할당 함수 필요
* [정렬된 메모리 할당](./posix_memalign)
## 비표준 타입의 정렬
* 비표준 타입
	* 구조체
	* 공용체(union)
	* 배열
* 구조체 정렬 요구 사항
	* 가장 큰 구성 요소 타입을 따름
		* 가장 큰 타입이 `32`비트 정수이고 `4`바이트 경계를 따라 정렬될 경우, 구조체 역시 최소 `4`바이트 경계를 따라 정렬
	* 채워넣기(padding)이 필요
		* `char`뒤에 `int`가 있을 경우 `3`바이트 padding이 필요
		* 공간 낭비를 막기 위해 GCC 컴파일러에 `-Wpadded` 옵션 사용 가능
* 공용체 정렬 요구 사항
	* 가장 큰 구성 요소 타입을 따름
* 배열 정렬 요구 사항
	* 기본 타입을 따름
	* 하드웨어에 따라 자연스럽게 정렬됨

