# 10. 프로세스 관리
## 프로세스
* 프로세스
	* 실행중인 프로그램
	* 자원 소유, 상태를 가짐
* 프로세스 ID
	* **특정 시점**에서 프로세스의 유일한 식별자
	* 순차적으로 할당됨
		* 프로세스 `A`, `B`, `C`가 만들어지면 PID는 `A < B < C`(**항상 참은 아님**)
	* 특별한 프로세스 ID
		* 0번: `swapper`(또는 `idle`) process
			* 실행될 프로세스가 없을 때 커널이 실행하는 프로세스
		* 1번: `init` process
			* 시스템의 초기화 담당
			* 모든 프로세스의 조상 프로세스
## 프로세스의 계층 구조
* 리눅스의 프로세스는 부모 자식의 관계를 가짐
	* 부모: 프로세스를 생성해주는 프로세스
	* 자식: 생성된 프로세스
	* 모든 프로세스의 부모는 init 프로세스
	* 쉘에서 `pstree` 명령을 쳐볼 것
* 프로세스 그룹
	* 모든 프로세스는 프로세스 그룹을 가짐
	* 다른 프로세스와의 관계를 나타냄
		* 유사한 관계가 있는 프로세스를 한 그룹으로 묶음
* `pid_t`
	* 프로세스의 `id`를 표현하는 타입
	* 일반적으로 `typedef`를 통해 `int` 타입으로 정의됨
## 프로세스 스케줄링
* 하나의 CPU 코어는 한번에 한 개의 프로세스밖에 수행할 수 없음
![readylist](./ready_list.png?raw=true)
* 실제로는 그림보다 훨씬 복잡한 메커니즘으로 스케줄링 알고리즘이 실행됨
* 리눅스 2.6에서는 `O(1)` 스케줄러 사용
## Process 상태 전이
* 프로세스 상태의 분류
	* 사용자 모드(user mode)에서 수행중인 상태
	* 커널 모드(kernel mode)에서 수행중인 상태
	* 수행 대기 상태
	* 수면(sleeping) 상태
* 프로세스 상태의 전이
	* CPU를 시간분할에 따라 프로세스에 할당
	* 프로세스들은 위에 언급된 상태를 이동하며 실행
* 프로세스 상태 전이도
![process-status-tree](./process_status_tree.png?raw=true)
## Process 구조
* 프로세스에 필요한 자료구조
![process-data-structure](./process_data_structure.png?raw=true)
* 사용자 구조 (user structure, U-area)
	* 프로세스의 상태를 기술
	* 수행중인 프로세스가 접근해야 하는 필드를 가짐
  * 시스템 호출에 의해 리턴된 에러 코드 (`errno`)
  * 프로세스 테이블의 포인터
  * 프로세스에 의해 open된 file descriptor
  * TEXT, DATA, STACK의 크기
  * 사용자 모드와 커널 모드에서 수행된 시간
  * 파일 생성 마스크 (`umask`)
  * Real user ID, effective user ID
  * 현재 디렉토리, 루트 디렉토리 등
* 프로세스 테이블 (Process Table)
	* 프로세스의 상태를 기술
  * 프로세스 관리를 위하여 커널에 필요한 정보를 기술
  * 프로세스 상태(수면, 실행중, ...)
  * 프로세스 플래그(swap 상태, swap될 수 없는 상태 등)
  * 프로세스 우선순위
  * 부모 프로세스 ID
  * 사용자 구조(U-area)의 포인터
  * 알람 시그널이 발생하기까지 남은 시간
  * Swap 가능한 영역의 주소와 크기

## 프로세스 관련 함수들
* 프로세스 식별자(Process ID)
	* [getpid](./getpid)
	* [setuid, setgid, seteuid, setegid](./set_id)
* 실행 이미지 대체 및 프로세스의 생성
	* 실행 이미지
		* 프로세스가 실행될 때 수행하는 코드 및 이와 관련된 자료구조를 의미
	* 실행 이미지 대체
		* 현재 실행중인 프로세스의 실행이미지를 대체하는 과정
		* `exec` 계열의 함수를 이용
			* `execl()`, `execlp()`, `execvp()`, `execv()`, `execle()`, `execve()`
	* 프로세스의 생성
		* `fork()`, `vfork()`
	* 보통 새로운 프로그램을 실행시킬 때
		* [fork()](./fork)를 통해 프로세스를 생성하고 [exec()](./exec)을 통해 실행 이미지를 대체


